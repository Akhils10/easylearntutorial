<!doctype html>
<html>
<head><title>Graph Traversal</title>
<style>canvas { width : 100%;}</style>
</head>
<body>

<script>
function calculatePath(map, startPos, targetPos, algorithm){
	function Stack(){
		this.items = [];
		this.length = this.items.length;
	}

	Stack.prototype.push = function(item){
		this.length += 1;
		return this.items.push(item);
	};

	Stack.prototype.pop = function(){
		if (this.length > 0) {
			this.length -= 1;
		}

		return this.items.pop();
	};

	Stack.prototype.top = function(){
		if (this.length > 0) {
			return this.items[this.length - 1];
		}

		return undefined;
	};

	var Node = function(id, adj){
		this.id = id;
		this.adj = adj;
	};

	function makeGraph(map, width, height) {
		var graph = [];

		for (var y = 1; y < height - 1; y++) {
			for (var x = 1; x < width - 1; x++) {
				if (map[y][x] === 1) {
					continue;
				}

				var adj = [];

				if (map[y - 1][x] === 0) {
					adj.push('' + x + ',' + (y - 1));
				}

				if (map[y + 1][x] === 0) {
					adj.push('' + x + ',' + (y + 1));
				}

				if (map[y][x - 1] === 0) {
					adj.push('' + (x - 1) + ',' + y);
				}

				if (map[y][x + 1] === 0) {
					adj.push('' + (x + 1) + ',' + y);
				}

				graph.push(new Node('' + x + ',' + y, adj));
			}
		}

		return graph;
	}

	function getNodeById(graph, nodeId) {
		return graph.reduce(function(out, node){
			if (node.id === nodeId) {
				out = node;
			}

			return out;
		});
	}

	var graph = makeGraph(map.data, map.width, map.height);
	var startNode = getNodeById(graph, startPos);
	var targetNode = getNodeById(graph, targetPos);

	// depth-first
	if (algorithm === 'depth-first') {
		var stack = new Stack();
		var path = [];
		stack.push(startNode);
		
		while (true) {
			var curNode = stack.top();
			path.push(curNode.id);
			curNode.visited = true;

			if (curNode.id === targetNode.id) {
				break;
			}

			var unvisited = 0;
			curNode.adj.forEach(function(id){
				var node = getNodeById(graph, id);
				if (!node.visited) {
					stack.push(node);
					unvisited += 1;
				}
			});

			if (unvisited === 0) {
				stack.pop();
			}
		}

		return path;
	}

	return [];
}
</script>

<script>
/*
var obj = {"map":[[1,1,1,1,1,1],[1,0,1,0,0,1],[1,0,0,0,1,1],[1,0,1,0,1,1],[1,1,1,1,1,1]],"path":["1,1","1,2","2,2","3,2","3,3","3,1","4,1","3,1","3,2","2,2","1,3"]};
var obj = {"map":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1],[1,0,0,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1],[1,0,1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1],[1,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1],[1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1],[1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1],[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1],[1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1],[1,0,1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1],[1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,0,1],[1,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,1,1],[1,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1],[1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1],[1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1],[1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1],[1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1],[1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,1],[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1],[1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1],[1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1],[1,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,1],[1,0,1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1],[1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1],[1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1],[1,0,0,0,1,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1],[1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1],[1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1],[1,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1],[1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1],[1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"path":["1,1","2,1","3,1","4,1","5,1","6,1","7,1","8,1","9,1","10,1","11,1","10,1","9,1","8,1","7,2","7,3","7,4","7,5","6,5","5,5","5,6","5,7","5,8","5,9","6,9","7,9","7,8","7,7","7,8","7,9","6,9","5,9","5,8","5,7","5,6","5,4","5,3","5,4","5,5","6,5","7,5","7,4","7,3","7,2","7,1","6,1","5,1","4,1","3,2","3,3","2,3","1,3","1,4","1,5","2,5","3,5","3,6","3,7","3,8","3,9","2,9","1,9","1,10","1,11","1,12","1,13","1,14","1,15","1,16","1,17","2,17","3,17","3,16","3,15","3,14","3,13","4,13","5,13","5,12","5,11","6,11","7,11","7,12","7,13","8,13","9,13","9,12","9,11","9,10","9,9","10,9","11,9","11,8","11,7","10,7","9,7","9,6","9,5","9,4","9,3","10,3","11,3","12,3","13,3","13,2","13,1","14,1","15,1","16,1","17,1","18,1","19,1","20,1","21,1","20,1","19,1","18,1","17,2","17,3","18,3","19,3","20,3","21,3","21,4","21,5","22,5","23,5","23,4","23,3","24,3","25,3","24,3","23,2","23,1","24,1","25,1","26,1","27,1","28,1","29,1","30,1","31,1","32,1","33,1","33,2","33,3","32,3","31,3","31,4","31,5","30,5","29,5","29,4","29,3","29,4","29,5","30,5","31,6","31,7","32,7","33,7","34,7","35,7","35,6","35,5","36,5","37,5","38,5","39,5","39,6","39,7","38,7","37,7","37,8","37,9","36,9","35,9","35,10","35,11","35,12","35,13","36,13","37,13","37,12","37,11","38,11","39,11","39,12","39,13","39,14","39,15","38,15","37,15","36,15","35,15","34,15","33,15","33,14","33,13","33,12","33,11","33,10","33,9","32,9","31,9","32,9","33,9","33,10","33,11","33,12","33,13","33,14","33,15","34,15","35,15","36,15","37,16","37,17","38,17","39,17","39,18","39,19","38,19","37,19","37,20","37,21","38,21","39,21","39,22","39,23","39,24","39,25","39,26","39,27","39,26","39,25","39,24","39,23","39,22","39,21","38,21","37,21","37,20","37,19","38,19","39,19","39,18","39,17","38,17","37,17","37,16","37,15","38,15","39,15","39,14","39,13","39,12","39,10","39,9","39,10","39,11","38,11","37,11","37,12","37,13","36,13","35,13","35,12","35,11","35,10","35,9","36,9","37,9","37,8","37,7","38,7","39,7","39,6","39,4","39,3","39,2","39,1","38,1","37,1","36,1","35,1","35,2","35,3","36,3","37,3","36,3","35,3","35,2","35,1","36,1","37,1","38,1","39,1","39,2","39,3","39,4","39,5","38,5","37,5","36,5","34,5","33,5","34,5","35,5","35,6","35,7","34,7","33,7","32,7","31,7","31,6","31,5","31,4","31,3","32,3","33,3","33,2","33,1","32,1","31,1","30,1","29,1","28,1","27,2","27,3","27,4","27,5","26,5","25,5","25,6","25,7","25,8","25,9","26,9","27,9","27,8","27,7","28,7","29,7","29,8","29,9","29,10","29,11","30,11","31,11","31,12","31,13","31,14","31,15","31,16","31,17","31,18","31,19","32,19","33,19","33,18","33,17","34,17","35,17","35,18","35,19","35,20","35,21","35,22","35,23","36,23","37,23","37,24","37,25","37,26","37,27","37,28","37,29","38,29","39,29","39,30","39,31","39,32","39,33","39,34","39,35","38,35","37,35","37,36","37,37","38,37","39,37","39,38","39,39","38,39","37,39","36,39","35,39","34,39","33,39","33,38","33,37","32,37","31,37","30,37","29,37","29,36","29,35","28,35","27,35","27,36","27,37","27,38","27,39","28,39","29,39","30,39","31,39","30,39","29,39","28,39","26,39","25,39","24,39","23,39","22,39","21,39","22,39","23,38","23,37","24,37","25,37","25,36","25,35","25,34","25,33","24,33","23,33","23,34","23,35","23,34","23,33","24,33","25,33","25,34","25,35","25,36","25,37","24,37","23,37","23,38","23,39","24,39","25,39","26,39","27,39","27,38","27,37","27,36","27,35","28,35","29,35","29,36","29,37","30,37","31,37","32,37","33,37","33,38","33,39","34,39","35,38","35,37","35,36","35,35","34,35","33,35","32,35","31,35","31,34","31,33","30,33","29,33","28,33","27,33","27,32","27,31","28,31","29,31","30,31","31,31","32,31","33,31","33,30","33,29","32,29","31,29","30,29","29,29","29,28","29,27","28,27","27,27","26,27","25,27","26,27","27,26","27,25","26,25","25,25","24,25","23,25","23,26","23,27","23,28","23,29","24,29","25,29","25,30","25,31","24,31","23,31","22,31","21,31","20,31","19,31","18,31","17,31","16,31","15,31","16,31","17,32","17,33","17,34","17,35","18,35","19,35","18,35","17,36","17,37","17,36","17,35","17,34","17,33","17,32","17,31","18,31","19,32","19,33","20,33","21,33","21,34","21,35","21,36","21,37","20,37","19,37","19,38","19,39","18,39","17,39","16,39","15,39","14,39","13,39","13,38","13,37","14,37","15,37","15,36","15,35","15,34","15,33","14,33","13,33","12,33","11,33","10,33","9,33","10,33","11,33","12,33","13,34","13,35","12,35","11,35","11,36","11,37","11,38","11,39","10,39","9,39","8,39","7,39","6,39","5,39","5,38","5,37","6,37","7,37","6,37","4,37","3,37","3,36","3,35","4,35","5,35","4,35","3,34","3,33","2,33","1,33","1,34","1,35","1,36","1,37","1,38","1,39","2,39","3,39","2,39","1,39","1,38","1,37","1,36","1,35","1,34","1,33","2,33","3,33","3,34","3,35","3,36","3,37","4,37","5,37","5,38","5,39","6,39","7,39","8,39","9,38","9,37","9,36","9,35","8,35","7,35","7,34","7,33","6,33","5,33","5,32","5,31","5,30","5,29","5,28","5,27","6,27","7,27","8,27","9,27","9,26","9,25","10,25","11,25","12,25","13,25","13,26","13,27","12,27","11,27","11,28","11,29","10,29","9,29","9,30","9,31","10,31","11,31","12,31","13,31","13,30","13,29","14,29","15,29","16,29","17,29","17,28","17,27","16,27","15,27","15,26","15,25","15,24","15,23","14,23","13,23","12,23","11,23","11,22","11,21","11,20","11,19","10,19","9,19","8,19","7,19","7,20","7,21","8,21","9,21","9,22","9,23","8,23","7,23","6,23","5,23","4,23","3,23","3,24","3,25","3,26","3,27","3,28","3,29","3,30","3,31","2,31","1,31","1,30","1,29","1,28","1,27","1,26","1,25","1,26","1,27","1,28","1,29","1,30","1,31","2,31","3,31","3,30","3,29","3,28","3,27","3,26","3,25","3,24","3,23","4,23","5,23","6,23","7,23","8,23","9,23","9,22","9,21","8,21","7,21","7,20","7,19","8,19","9,19","10,19","11,19","11,20","11,21","11,22","11,23","12,23","13,23","14,23","15,23","15,24","15,25","15,26","15,27","16,27","17,27","17,28","17,29","16,29","15,29","14,29","13,29","13,30","13,31","12,31","11,31","10,31","9,31","9,30","9,29","10,29","11,29","11,28","11,27","12,27","13,27","13,26","13,25","12,25","11,25","10,25","9,25","9,26","9,27","8,27","7,27","6,27","5,26","5,25","6,25","7,25","6,25","5,25","5,26","5,27","5,28","5,29","5,30","5,31","5,32","5,33","6,33","7,32","7,31","7,30","7,29","7,30","7,31","7,32","7,33","7,34","7,35","8,35","9,35","9,36","9,37","9,38","9,39","10,39","11,39","11,38","11,37","11,36","11,35","12,35","13,35","13,34","13,33","14,33","15,33","15,34","15,35","15,36","15,37","14,37","13,37","13,38","13,39","14,39","15,39","16,39","17,39","18,39","19,39","19,38","19,37","20,37","21,37","21,36","21,35","21,34","21,33","20,33","19,33","19,32","19,31","20,31","21,31","22,31","23,31","24,31","25,31","25,30","25,29","24,29","23,29","23,28","23,27","23,26","23,25","24,25","25,25","26,25","27,25","27,26","27,27","28,27","29,27","29,28","29,29","30,29","31,29","32,29","33,29","33,30","33,31","32,31","31,31","30,31","29,31","28,31","27,30","27,29","27,30","27,31","27,32","27,33","28,33","29,33","30,33","31,33","31,34","31,35","32,35","33,35","34,35","35,35","35,36","35,37","35,38","35,39","36,39","37,39","38,39","39,39","39,38","39,37","38,37","37,37","37,36","37,35","38,35","39,35","39,34","39,33","39,32","39,31","39,30","39,29","38,29","37,29","37,28","37,27","37,26","37,25","37,24","37,23","36,23","35,23","35,22","35,21","35,20","35,19","35,18","35,17","34,17","33,17","33,18","33,19","32,19","31,19","31,18","31,17","31,16","31,15","31,14","31,13","31,12","31,11","30,11","29,11","29,10","29,9","29,8","29,7","28,7","27,7","27,8","27,9","26,9","25,9","25,8","25,7","25,6","25,5","26,5","27,5","27,4","27,3","27,2","27,1","26,1","25,1","24,1","23,1","23,2","23,3","23,4","23,5","22,5","21,5","21,4","21,3","20,3","19,3","18,3","17,3","17,2","17,1","16,1","15,1","14,1","13,1","13,2","13,3","12,3","11,3","10,3","9,3","9,4","9,5","9,6","9,7","10,7","11,7","11,8","11,9","10,9","9,9","9,10","9,11","9,12","9,13","8,13","7,13","7,12","7,11","6,11","5,11","5,12","5,13","4,13","3,13","3,14","3,15","3,16","3,17","2,17","1,18","1,19","1,20","1,21","2,21","3,21","3,20","3,19","4,19","5,19","5,20","5,21","5,20","5,18","5,17","6,17","7,17","8,17","9,17","10,17","11,17","11,16","11,15","10,15","9,15","8,15","7,15","6,15","5,15","6,15","7,15","8,15","9,15","10,15","11,14","11,13","12,13","13,13","13,14","13,15","14,15","15,15","16,15","17,15","17,14","17,13","16,13","15,13","15,12","15,11","14,11","13,11","12,11","11,11","12,11","13,10","13,9","14,9","15,9","15,8","15,7","15,6","15,5","16,5","17,5","18,5","19,5","19,6","19,7","18,7","17,7","17,8","17,9","18,9","19,9","20,9","21,9","22,9","23,9","23,10","23,11","23,12","23,13","23,14","23,15","24,15","25,15","26,15","27,15","28,15","29,15","29,16","29,17","28,17","27,17","27,18","27,19","27,20","27,21","27,22","27,23","28,23","29,23","29,22","29,21","30,21","31,21","32,21","33,21","33,22","33,23","33,24","33,25","34,25","35,25","35,26","35,27","34,27","33,27","32,27","31,27","31,26","31,25","30,25","29,25","30,25","31,24","31,23","31,24","31,25","31,26","31,27","32,27","33,27","34,27","35,28","35,29","35,30","35,31","36,31","37,31","37,32","37,33","36,33","35,33","34,33","33,33","34,33","35,33","36,33","37,33","37,32","37,31","36,31","35,31","35,30","35,29","35,28","35,27","35,26","35,25","34,25","33,25","33,24","33,23","33,22","33,21","32,21","31,21","30,21","29,20","29,19","29,20","29,21","29,22","29,23","28,23","26,23","25,23","25,22","25,21","25,20","25,19","25,18","25,17","24,17","23,17","22,17","21,17","21,16","21,15","21,14","21,13","21,12","21,11","20,11","19,11","18,11","17,11","18,11","19,12","19,13","19,14","19,15","19,16","19,17","18,17","17,17","16,17","15,17","15,18","15,19","15,20","15,21","16,21","17,21","17,20","17,19","18,19","19,19","19,20","19,21","19,22","19,23","20,23","21,23","21,24","21,25","21,26","21,27","20,27","19,27","19,28","19,29","20,29","21,29","20,29","19,29","19,28","19,26","19,25","18,25","17,25","17,24","17,23","17,24","17,25","18,25","19,25","19,26","19,27","20,27","21,27","21,26","21,25","21,24","21,22","21,21","21,20","21,19","22,19","23,19","23,20","23,21","23,22","23,23","23,22","23,21","23,20","23,19","22,19","21,19","21,20","21,21","21,22","21,23","20,23","19,23","19,22","19,21","19,20","19,19","18,19","17,19","17,20","17,21","16,21","14,21","13,21","13,20","13,19","13,18","13,17","13,18","13,19","13,20","13,21","14,21","15,21","15,20","15,19","15,18","15,17","16,17","17,17","18,17","19,17","19,16","19,15","19,14","19,13","19,12","19,11","20,11","21,11","21,12","21,13","21,14","21,15","21,16","21,17","22,17","23,17","24,17","25,17","25,18","25,19","25,20","25,21","25,22","25,23","26,23","27,23","27,22","27,21","27,20","27,19","27,18","27,17","28,17","29,17","29,16","29,14","29,13","28,13","27,13","27,12","27,11","26,11","25,11","25,12","25,13","25,12","25,11","26,11","27,11","27,12","27,13","28,13","29,13","29,14","29,15","28,15","27,15","26,15","25,15","24,15","23,15","23,14","23,13","23,12","23,11","23,10","23,8","23,7","22,7","21,7","22,7","23,7","23,8","23,9","22,9","21,9","20,9","19,9","18,9","17,9","17,8","17,7","18,7","19,7","19,6","19,5","18,5","17,5","16,5","14,5","13,5","12,5","11,5"],"start":"1,1","target":"11,5"}



var cellWidth = 20;
var cellHeight = 19;
var mapWidth = obj.map[0].length;
var mapHeight = obj.map.reduce(function(acc, row){ return acc + 1; }, 0);

var start = makePoint(obj.start);
var target = makePoint(obj.target);	

var canvas = document.createElement('canvas');
canvas.width = cellWidth * mapWidth;
canvas.height = cellHeight * mapHeight;

var ctx = canvas.getContext('2d');

function drawMap(){
	ctx.clearRect(0, 0, canvas.width, canvas.height);
	for (var y = 0; y < mapHeight; y++) {
		for (var x = 0; x < mapWidth; x++) {
			var cellType = obj.map[y][x];

			if (cellType === 1) {
				ctx.fillStyle = '#333';
			} else {
				ctx.fillStyle = '#c00';
			}

			ctx.fillRect(x * cellWidth, y * cellHeight, cellWidth, cellHeight);
		}
	}
}

function makePoint(pt){
	return pt.split(',')
		.map(function(v){ return v | 0; });
}

function drawPath(index){
	var point = makePoint(obj.path[index]);
		

	ctx.fillStyle = '#fff';
	ctx.fillRect(point[0] * cellWidth, point[1] * cellHeight, cellWidth, cellHeight);
}

function drawPoint(point, useOnColor, onColor, offColor) {
	ctx.save();
	ctx.globalAlpha = 1.0;
	if (useOnColor) {
		ctx.fillStyle = onColor;
	} else {
		ctx.fillStyle = offColor;
	}
		
	ctx.fillRect(point[0] * cellWidth, point[1] * cellHeight, cellWidth, cellHeight);
	ctx.restore();
}

function go(delay) {
	var pos = 0;

	function render(){
		if (pos < obj.path.length) {
			drawPath(pos);
		}

		pos += 1;
		setTimeout(render, delay);

		drawPoint(target, pos % 50 > 30, '#0c0', '#c00');
	}

	drawMap();

	ctx.globalAlpha = 0.55;
	return render();
}
*/
/*
document.body.appendChild(canvas);
drawMap();
drawPoint(target, 1, '#0c0', '#c00');
drawPoint(start, 1, '#fff', '#c00');
canvas.addEventListener('click', go.bind(null, 5));
*/

function fetchMaze(path) {
	return new Promise(function(resolve, reject){
		var xhr = new XMLHttpRequest();
		xhr.onload = function(){
			if (this.readyState === 4 && this.status === 200) {
				resolve(this.responseText);
			}
		};

		xhr.open('get', path, true);
		xhr.send();
	});
}


function makeRenderer(map, primaryColor, secondaryColor){
	var canvas = document.createElement('canvas');
	canvas.width = map.cellWidth * map.width;
	canvas.height = map.cellHeight * map.height;

	return {
		canvas: canvas,
		ctx: canvas.getContext('2d'),
		primaryColor: primaryColor,
		secondaryColor: secondaryColor,
	};
}

function makeMap(mapData, cellWidth, cellHeight) {
	return {
		data: mapData,
		width: mapData[0].length,
		height: mapData.reduce(function(acc, row){ return acc + 1; }, 0),
		cellWidth: cellWidth,
		cellHeight: cellHeight
	};
}

function drawMap(renderer, map){
	var ctx = renderer.ctx;
	var canvas = renderer.canvas;

	ctx.clearRect(0, 0, canvas.width, canvas.height);
	for (var y = 0; y < map.height; y++) {
		for (var x = 0; x < map.width; x++) {
			var cellType = map.data[y][x];

			if (cellType === 1) {
				ctx.fillStyle = renderer.secondaryColor;//'#333';
			} else {
				ctx.fillStyle = renderer.primaryColor;//'#c00';
			}

			ctx.fillRect(x * map.cellWidth, y * map.cellHeight, map.cellWidth, map.cellHeight);
		}
	}
}

function makePoint(pt){
	return pt.split(',')
		.map(function(v){ return v | 0; });
}

function drawPath(renderer, point, width, height, color){
	// var point = makePoint(obj.path[index]);
	renderer.ctx.fillStyle = color;//'#fff';
	renderer.ctx.fillRect(point[0] * width, point[1] * height, width, height);
}

function drawPoint(renderer, point, width, height, useOnColor, onColor, offColor) {
	var ctx = renderer.ctx;
	var color = offColor;

	ctx.save();
	ctx.globalAlpha = 1.0;

	if (useOnColor) {
		color = onColor;
	}

	drawPath(renderer, point, width, height, color);
	ctx.restore();
}

function go(slider, path, renderer, map, start, target) {
	var pos = 0;

	function render(){
		if (pos < path.length) {
			drawPath(renderer, makePoint(path[pos]), map.cellWidth, map.cellHeight, '#fff');
		} else {
			drawPath(renderer, target, map.cellWidth, map.cellHeight, '#0f0');
			return;
		}

		pos += 1;
		setTimeout(render, slider.value);

		drawPoint(renderer, target, map.cellWidth, map.cellHeight, pos % 50 > 30, '#0c0', '#c00');
	}

	renderer.ctx.globalAlpha = 0.55;

	return render();
}

fetchMaze('/maze-001.json')
	.then(function(mapData){
		var map = makeMap(JSON.parse(mapData), 19, 19);
		var renderer = makeRenderer(map, '#c00', '#333');
		var startPos = '1,1';
		var targetPos = '11,5';
		var algorithm = 'depth-first';
	
		var path = [];//calculatePath(map, startPos, targetPos, algorithm);

		document.body.appendChild(renderer.canvas);
		drawMap(renderer, map);
		drawPath(renderer, makePoint(startPos), map.cellWidth, map.cellHeight, '#fff');
		drawPath(renderer, makePoint(targetPos), map.cellWidth, map.cellHeight, '#0f0');

		var btn01 = document.createElement('button');
		btn01.textContent = 'Depth-first';
		btn01.addEventListener('click', start.bind(null, 'depth-first'));
		document.body.appendChild(btn01);

		var btn01 = document.createElement('button');
		btn01.textContent = 'Breadth-first';
		btn01.addEventListener('click', start.bind(null, 'breadth-first'));
		document.body.appendChild(btn01);

		var slider = document.createElement('input');
		slider.type = 'range';
		slider.min = 0;
		slider.max = 100;
		slider.step = 5;
		slider.value = 10;
		document.body.appendChild(slider);

		var label = document.createElement('span');
		label.textContent = slider.value;
		document.body.appendChild(label);

		slider.addEventListener('change', function(){
			label.textContent = this.value;
		});
		// go(50, path, renderer, map, makePoint(startPos), makePoint(targetPos));

		function start(algorithm) {
			path = calculatePath(map, startPos, targetPos, algorithm);
			go(slider, path, renderer, map, makePoint(startPos), makePoint(targetPos));
		}
	});

</script>

</body>

